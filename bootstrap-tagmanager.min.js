(function(c){var d={prefilled:null,CapitalizeFirstLetter:false,preventSubmitOnEnter:true,isClearInputOnEsc:true,typeahead:false,typeaheadAjaxSource:null,typeaheadAjaxPolling:false,typeaheadOverrides:null,typeaheadSource:null,AjaxPush:null,AjaxPushAllTags:null,delimeters:[44,188,13,9],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,deleteTagsOnBackspace:true,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:false},e=(function(){function f(){this.instanceSelectHandler=null;this.selectedClass="selected";this.select=null;if("typeahead" in c.fn){this.instanceSelectHandler=c.fn.typeahead.Constructor.prototype.select;this.select=function(g){this.$menu.find(".active").addClass(g.selectedClass);g.instanceSelectHandler.apply(this,arguments)}}}return f}()),a={pushTag:function(q,p){p=(typeof p==="boolean")?p:true;var o=this,m=o.data("tlis"),i=o.data("tlid"),j=m.map(function(r){return r.toLowerCase()}),g=-1,n=Math.max.apply(null,i),h,l,f,k="";if(!q||!p||q.length<=0){return}if(o.data("opts").onlyTagList){if(o.data("opts").typeaheadSource!=null){if((c.inArray(q,o.data("opts").typeaheadSource))==-1){return}}}if(o.data("opts").CapitalizeFirstLetter&&q.length>1){q=q.charAt(0).toUpperCase()+q.slice(1).toLowerCase()}if(c.isFunction(o.data("opts").validator)){if(!o.data("opts").validator(q)){return}}if(o.data("opts").maxTags>0&&m.length>=o.data("opts").maxTags){return}g=c.inArray(q.toLowerCase(),j);if(-1!=g){c("#"+o.data("tag_prefix")+"_"+i[g]).stop().animate({backgroundColor:o.data("opts").blinkBGColor_1},100).animate({backgroundColor:o.data("opts").blinkBGColor_2},100).animate({backgroundColor:o.data("opts").blinkBGColor_1},100).animate({backgroundColor:o.data("opts").blinkBGColor_2},100).animate({backgroundColor:o.data("opts").blinkBGColor_1},100).animate({backgroundColor:o.data("opts").blinkBGColor_2},100)}else{n=(n==-Infinity)?0:n;h=++n;m.push(q);i.push(h);if(o.data("opts").AjaxPush!=null){c.post(o.data("opts").AjaxPush,{tag:q})}l=o.data("tag_prefix")+"_"+h;f=o.data("tag_prefix")+"_Remover_"+h;k+='<span class="myTag'+(o.data("opts").tagClass?" "+o.data("opts").tagClass:"")+'" id="'+l+'"><span>'+q+'&nbsp;&nbsp;</span><a href="#" class="myTagRemover" id="'+f+'" TagIdToRemove="'+h+'" title="Remove">'+o.data("opts").tagCloseIcon+"</a></span>";if(o.data("opts").tagsContainer!=null){c(o.data("opts").tagsContainer).append(k)}else{o.before(k)}c("#"+f).on("click",function(s){s.preventDefault();var r=parseInt(c(this).attr("TagIdToRemove"));b.spliceTag.call(o,r,s.data)});b.refreshHiddenTagList.call(o);if(o.data("opts").maxTags>0&&m.length>=o.data("opts").maxTags){o.hide()}o.trigger("tags:add")}o.val("")},popTag:function(){var f=this;if(f.data("tlid").length>0){b.spliceTag.call(f,f.data("tlid")[0])}},empty:function(){var f=this;while(f.data("tlid").length>0){b.spliceTag.call(f,f.data("tlid")[0])}}},b={init:function(f){d.typeaheadOverrides=new e();var g=c.extend({},d,f);g.hiddenTagListName=(g.hiddenTagListName===null)?"hidden-"+this.attr("name"):g.hiddenTagListName;this.each(function(){var n=c(this),h="",m=false,i=false,k=c('input[name="'+g.hiddenTagListName+'"]'),j="",l=[];if(g.AjaxPushAllTags){n.on("tags:refresh",function(p,o){b.postTags.call(n,p,o)})}n.data("opts",g).data("tag_prefix",n.attr("name").replace(/[^\w]/g,"_")).data("tlis",[]).data("tlid",[]);if(g.hiddenTagListId==null){if(k.length>0){k.remove()}j+='<input name="'+g.hiddenTagListName+'" type="hidden" value="" />';n.after(j);n.data("lhiddenTagList",n.siblings('input[name="'+g.hiddenTagListName+'"]')[0])}else{n.data("lhiddenTagList",c("#"+g.hiddenTagListId))}if(g.typeahead){b.setupTypeahead.call(n)}n.on("focus",function(o){if(n.popover){n.popover("hide")}});if(g.isClearInputOnEsc){n.on("keyup",function(o){if(o.which==27){n.val("");o.cancelBubble=true;o.returnValue=false;o.stopPropagation();o.preventDefault();return false}})}n.on("keypress",function(o){if(n.popover){n.popover("hide")}if(g.preventSubmitOnEnter){if(o.which==13){o.cancelBubble=true;o.returnValue=false;o.stopPropagation();o.preventDefault();return false}}if(!("0" in c(".typeahead:visible"))&&(-1!=c.inArray(o.which,g.delimeters))){m=true;a.pushTag.call(n,b.trimTag(c(this).val(),g.delimeters),o.data,m);o.preventDefault()}else{m=false}});if(g.deleteTagsOnBackspace){n.on("keydown",function(s){var r=c.inArray(s.which,g.backspace),o,q;if(-1!=r){o=c(this).val();if(o.length<=0){s.preventDefault();a.popTag.call(n)}}})}n.change(function(v){v.cancelBubble=true;v.returnValue=false;v.stopPropagation();v.preventDefault();var t=g.typeaheadOverrides.selectedClass,o="."+t,w=navigator.userAgent.indexOf("Chrome")>-1,s=navigator.userAgent.indexOf("MSIE")>-1,u=navigator.userAgent.indexOf("Firefox")>-1,q=navigator.userAgent.indexOf("Safari")>-1,r=false,p;if(n.data("typeahead")){i=n.data("typeahead").$menu.find("*").filter(o).hasClass(t);if(i){m=true}}if(!m){return false}if(!w&&!q){n.focus()}if(c(".typeahead:visible")[0]!=undefined){r=!i;if(i){p=n.data("typeahead").$menu.find(o).attr("data-value");p=b.trimTag(p,g.delimeters);if(h==c(this).val()&&h==p){r=true}else{a.pushTag.call(n,p,true);h=p}i=false;n.data("typeahead").$menu.find(o).removeClass(t)}if(r){h="";n.val(h)}}else{p=n.val();p=b.trimTag(p,g.delimeters);a.pushTag.call(n,p,true)}m=false;return false});if(true||!g.typeahead){n.on("blur",function(q){q.cancelBubble=true;q.returnValue=false;q.stopPropagation();q.preventDefault();var p=true,o;if(g.typeahead){p=(c(".typeahead:visible")[0]!=undefined)?false:true}if(p){o=n.val();o=b.trimTag(o,g.delimeters);a.pushTag.call(n,o,m)}return false})}if(g.prefilled!=null){if(typeof(g.prefilled)=="object"){l=g.prefilled}else{if(typeof(g.prefilled)=="string"){l=g.prefilled.split(",")}}c.each(l,function(o,p){a.pushTag.call(n,p,true)})}});return this},trimTag:function(g,m){var f=c.trim(g),h=f.length,k=0;for(var j=h-1;j>=0;j--){if(-1==c.inArray(f.charCodeAt(j),m)){break}k++}f=f.substring(0,h-k);h=f.length;k=0;for(var j=0;j<h;j++){if(-1==c.inArray(f.charCodeAt(j),m)){break}k++}f=f.substring(k,h);return f},spliceTag:function(h){var j=this,i=j.data("tlis"),g=j.data("tlid"),f=c.inArray(h,g);if(-1!=f){c("#"+j.data("tag_prefix")+"_"+h).remove();i.splice(f,1);g.splice(f,1);b.refreshHiddenTagList.call(j);j.trigger("tags:remove")}if(j.data("opts").maxTags>0&&i.length<j.data("opts").maxTags){j.show()}},refreshHiddenTagList:function(){var h=this,g=h.data("tlis"),f=h.data("lhiddenTagList");h.trigger("tags:refresh",g.join(","));if(f){c(f).val(g.join(",")).change()}},postTags:function(g,f){var h=this;if(h.data("opts").AjaxPushAllTags){c.post(h.data("opts").AjaxPushAllTags,{tags:f})}},setTypeaheadSource:function(f){var g=this;g.data("active",true);g.data("typeahead").source=f;g.data("active",false)},ajaxPolling:function(f,g){var h=this;if(typeof(h.data("opts").typeaheadAjaxSource)=="string"){c.ajax({cache:false,type:"POST",contentType:"application/json",dataType:"json",url:h.data("opts").typeaheadAjaxSource,data:JSON.stringify({typeahead:f}),success:function(i){b.onTypeaheadAjaxSuccess(i,false,g)}})}},setupTypeahead:function(){var f=this;if(!f.typeahead){return}if(f.data("opts").typeaheadSource!=null&&c.isFunction(f.data("opts").typeaheadSource)){f.typeahead({source:f.data("opts").typeaheadSource})}else{if(f.data("opts").typeaheadSource!=null){f.typeahead();b.setTypeaheadSource.call(f,f.data("opts").typeaheadSource)}else{if(f.data("opts").typeaheadAjaxSource!=null){if(!f.data("opts").typeaheadAjaxPolling){f.typeahead();if(typeof(f.data("opts").typeaheadAjaxSource)=="string"){c.ajax({cache:false,type:"POST",contentType:"application/json",dataType:"json",url:f.data("opts").typeaheadAjaxSource,data:JSON.stringify({typeahead:""}),success:function(g){b.onTypeaheadAjaxSuccess.call(f,g,true)}})}}else{if(f.data("opts").typeaheadAjaxPolling){f.typeahead({source:b.ajaxPolling.call(f)})}}}else{if(f.data("opts").typeaheadDelegate){f.typeahead(f.data("opts").typeaheadDelegate)}}}}if(f.data("typeahead")){f.data("typeahead").select=c.proxy(f.data("opts").typeaheadOverrides.select,f.data("typeahead"),f.data("opts").typeaheadOverrides)}},onTypeaheadAjaxSuccess:function(h,g,i){var j=this,f=[];if("d" in h){h=h.d}if(h&&h.tags){f.length=0;c.each(h.tags,function(k,l){f.push(l.tag);if(g){b.setTypeaheadSource.call(j,f)}});if(c.isFunction(i)){i(f)}}},log:function(f){if(typeof console!="undefined"){console.log(f)}}};c.fn.tagsManager=function(g){var f=c(this);if(a[g]){return a[g].apply(f,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return b.init.apply(this,arguments)}else{c.error("Method "+g+" does not exist.");return false}}}}(jQuery));